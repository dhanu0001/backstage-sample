{"version":3,"file":"index.esm.js","sources":["../src/manifest.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fetch from 'cross-fetch';\n\nconst VERSIONS_DOMAIN = 'https://versions.backstage.io';\n\n/**\n * Contains mapping between Backstage release and package versions.\n * @public\n */\nexport type ReleaseManifest = {\n  releaseVersion: string;\n  packages: { name: string; version: string }[];\n};\n\n/**\n * Options for {@link getManifestByVersion}.\n * @public\n */\nexport type GetManifestByVersionOptions = {\n  version: string;\n};\n\n/**\n * Returns a release manifest based on supplied version.\n * @public\n */\nexport async function getManifestByVersion(\n  options: GetManifestByVersionOptions,\n): Promise<ReleaseManifest> {\n  const url = `${VERSIONS_DOMAIN}/v1/releases/${encodeURIComponent(\n    options.version,\n  )}/manifest.json`;\n  const response = await fetch(url);\n  if (response.status === 404) {\n    throw new Error(`No release found for ${options.version} version`);\n  }\n  if (response.status !== 200) {\n    throw new Error(\n      `Unexpected response status ${response.status} when fetching release from ${url}.`,\n    );\n  }\n  return await response.json();\n}\n\n/**\n * Options for {@link getManifestByReleaseLine}.\n * @public\n */\nexport type GetManifestByReleaseLineOptions = {\n  releaseLine: string;\n};\n\n/**\n * Returns a release manifest based on supplied release line.\n * @public\n */\nexport async function getManifestByReleaseLine(\n  options: GetManifestByReleaseLineOptions,\n): Promise<ReleaseManifest> {\n  const url = `${VERSIONS_DOMAIN}/v1/tags/${encodeURIComponent(\n    options.releaseLine,\n  )}/manifest.json`;\n  const response = await fetch(url);\n  if (response.status === 404) {\n    throw new Error(`No '${options.releaseLine}' release line found`);\n  }\n  if (response.status !== 200) {\n    throw new Error(\n      `Unexpected response status ${response.status} when fetching release from ${url}.`,\n    );\n  }\n  return await response.json();\n}\n"],"names":[],"mappings":";;AAkBA,MAAM,eAAkB,GAAA,+BAAA,CAAA;AAuBxB,eAAsB,qBACpB,OAC0B,EAAA;AAC1B,EAAM,MAAA,GAAA,GAAM,GAAG,eAA+B,CAAA,aAAA,EAAA,kBAAA;AAAA,IAC5C,OAAQ,CAAA,OAAA;AAAA,GACV,CAAA,cAAA,CAAA,CAAA;AACA,EAAM,MAAA,QAAA,GAAW,MAAM,KAAA,CAAM,GAAG,CAAA,CAAA;AAChC,EAAI,IAAA,QAAA,CAAS,WAAW,GAAK,EAAA;AAC3B,IAAA,MAAM,IAAI,KAAA,CAAM,CAAwB,qBAAA,EAAA,OAAA,CAAQ,OAAiB,CAAA,QAAA,CAAA,CAAA,CAAA;AAAA,GACnE;AACA,EAAI,IAAA,QAAA,CAAS,WAAW,GAAK,EAAA;AAC3B,IAAA,MAAM,IAAI,KAAA;AAAA,MACR,CAAA,2BAAA,EAA8B,SAAS,MAAqC,CAAA,4BAAA,EAAA,GAAA,CAAA,CAAA,CAAA;AAAA,KAC9E,CAAA;AAAA,GACF;AACA,EAAO,OAAA,MAAM,SAAS,IAAK,EAAA,CAAA;AAC7B,CAAA;AAcA,eAAsB,yBACpB,OAC0B,EAAA;AAC1B,EAAM,MAAA,GAAA,GAAM,GAAG,eAA2B,CAAA,SAAA,EAAA,kBAAA;AAAA,IACxC,OAAQ,CAAA,WAAA;AAAA,GACV,CAAA,cAAA,CAAA,CAAA;AACA,EAAM,MAAA,QAAA,GAAW,MAAM,KAAA,CAAM,GAAG,CAAA,CAAA;AAChC,EAAI,IAAA,QAAA,CAAS,WAAW,GAAK,EAAA;AAC3B,IAAA,MAAM,IAAI,KAAA,CAAM,CAAO,IAAA,EAAA,OAAA,CAAQ,WAAiC,CAAA,oBAAA,CAAA,CAAA,CAAA;AAAA,GAClE;AACA,EAAI,IAAA,QAAA,CAAS,WAAW,GAAK,EAAA;AAC3B,IAAA,MAAM,IAAI,KAAA;AAAA,MACR,CAAA,2BAAA,EAA8B,SAAS,MAAqC,CAAA,4BAAA,EAAA,GAAA,CAAA,CAAA,CAAA;AAAA,KAC9E,CAAA;AAAA,GACF;AACA,EAAO,OAAA,MAAM,SAAS,IAAK,EAAA,CAAA;AAC7B;;;;"}